import{u as z,B as G,g as J,n as X,C as Z}from"./q-D5DYOS3k.js";import{b as _t}from"./q-D5DYOS3k.js";import{x as P,w as $,n as _,F as tt,v as et,q as ot,r as rt,G as it,o as nt,H as S,I as f,s as at,J as lt,K as st}from"./q-B8PPvEXs.js";import{c as x,m as B,r as N}from"./q-BdRmJiWH.js";import"./q-7J8Whc3t.js";const ft=({track:O})=>{const[V,R,W,u,ct,A,M,w,j,E,d]=z();async function F(){var T;const[l,H]=O(()=>[E.value,V.value]),K=G(""),p=d.url,n=H?"form":l.type,Q=l.replaceState;let o,m,L=null,v;{o=new URL(l.dest,location),o.pathname.endsWith("/")||(o.pathname+="/");let C=P(N,B,x,o.pathname);v=J();const q=m=await $(o,v,{action:H,clearCache:!0});if(!q){E.untrackedValue={type:n,dest:o};return}const b=q.href,g=new URL(b,o);_(g,o)||(o=g,C=P(N,B,x,o.pathname));try{L=await C}catch{window.location.href=b;return}}if(L){const[C,q,b,g]=L,h=b,Y=h[h.length-1],k=n==="form"&&!_(o,p);l.dest.search&&!k&&(o.search=l.dest.search),_(o,p)||(d.prevUrl=p),d.url=o,d.params={...q},E.untrackedValue={type:n,dest:o};const y=tt(m,d,h,K);R.headings=Y.headings,R.menu=g,W.value=X(h),u.links=y.links,u.meta=y.meta,u.styles=y.styles,u.scripts=y.scripts,u.title=y.title,u.frontmatter=y.frontmatter;{j.viewTransition!==!1&&(document.__q_view_transition__=!0);let D;n==="popstate"&&(D=et());const s=document.getElementById(ot)??document.documentElement;(l.scroll&&(!l.forceReload||!_(o,p))&&(n==="link"||n==="popstate")||k)&&(document.__q_scroll_restore__=()=>rt(n,o,p,s,D));const U=m==null?void 0:m.loaders,t=window;if(U&&Object.assign(M,U),it.clear(),!t._qCitySPA){if(t._qCitySPA=!0,history.scrollRestoration="manual",t.addEventListener("popstate",()=>{t._qCityScrollEnabled=!1,clearTimeout(t._qCityScrollDebounce),A(location.href,{type:"popstate"})}),t.removeEventListener("popstate",t._qCityInitPopstate),t._qCityInitPopstate=void 0,!t._qCityHistoryPatch){t._qCityHistoryPatch=!0;const r=history.pushState,a=history.replaceState,c=e=>(e===null||typeof e>"u"?e={}:(e==null?void 0:e.constructor)!==Object&&(e={_data:e}),e._qCityScroll=e._qCityScroll||f(s),e);history.pushState=(e,i,I)=>(e=c(e),r.call(history,e,i,I)),history.replaceState=(e,i,I)=>(e=c(e),a.call(history,e,i,I))}document.body.addEventListener("click",r=>{if(r.defaultPrevented)return;const a=r.target.closest("a[href]");if(a&&!a.hasAttribute("preventdefault:click")){const c=a.getAttribute("href"),e=new URL(location.href),i=new URL(c,e);if(nt(i,e)&&_(i,e)){if(r.preventDefault(),!i.hash&&!i.href.endsWith("#")){i.href!==e.href&&history.pushState(null,"",i),t._qCityScrollEnabled=!1,clearTimeout(t._qCityScrollDebounce),S({...f(s),x:0,y:0}),location.reload();return}A(a.getAttribute("href"))}}}),document.body.removeEventListener("click",t._qCityInitAnchors),t._qCityInitAnchors=void 0,window.navigation||(document.addEventListener("visibilitychange",()=>{if(t._qCityScrollEnabled&&document.visibilityState==="hidden"){const r=f(s);S(r)}},{passive:!0}),document.removeEventListener("visibilitychange",t._qCityInitVisibility),t._qCityInitVisibility=void 0),t.addEventListener("scroll",()=>{t._qCityScrollEnabled&&(clearTimeout(t._qCityScrollDebounce),t._qCityScrollDebounce=setTimeout(()=>{const r=f(s);S(r),t._qCityScrollDebounce=void 0},200))},{passive:!0}),removeEventListener("scroll",t._qCityInitScroll),t._qCityInitScroll=void 0,(T=t._qCityBootstrap)==null||T.remove(),t._qCityBootstrap=void 0,at.resolve()}if(n!=="popstate"){t._qCityScrollEnabled=!1,clearTimeout(t._qCityScrollDebounce);const r=f(s);S(r)}lt(window,n,p,o,Q),Z(v).then(()=>{var c;st(v).setAttribute("q:route",C);const a=f(s);S(a),t._qCityScrollEnabled=!0,d.isNavigating=!1,(c=w.r)==null||c.call(w)})}}}F()};export{_t as _hW,ft as s_QyF9A1h1ueY};
